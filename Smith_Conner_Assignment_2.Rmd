---
title: "ESM 204 - Assignment 2"
author: "Conner Smith"
date: "4/13/2022"
output:
  html_document:
   theme:
     bg: "#002B36"
     fg: "#EEE8D5"
     primary: "#2AA198"
   code_folding: hide
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(janitor)
library(thematic)
library(scales)
library(equatiomatic)

thematic::thematic_rmd()
thematic::thematic_on()

```


## Overview

```{r}
# Read in the main data set

districts <- read_csv(here("Water_Districts.csv")) %>% 
  clean_names() %>% 
  select(-x1)

# Adding image
#include_graphics(here('chinook.jpg'))
```

[Source: Corvallis Advocate](https://www.corvallisadvocate.com/2020/army-corps-failed-to-protect-willamette-river-salmon-judge-rules/)

Agricultural water is managed by irrigation districts and is increasingly scarce. To conserve water and reduce costs, four irrigation districts are considering developing a water market, in which water rights would be traded across the districts. In this homework you will conduct data analysis, simulations, and policy analysis to help inform the development of the water market. 

**Data Citation**
*University of Washington, Columbia Basin Research. 2010. DART Adult Passage Graphics & Text.* http://www.cbr.washington.edu/dart/query/adult_graph_text.

## **Analysis** {.tabset}

The dataset contains estimates of the marginal cost of reducing water use in each of the four irrigation districts (Kern, Mojave, Antelope, and Ventura) for different levels of reduction (in Acre Feet).

Current (i.e. baseline) water use in these districts is: 
- Kern = 150 AF
- Mojave = 140 AF
- Antelope = 220 AF 
- Ventura = 245 AF

Prices are in $/Acre Foot and quantities are in Acre Feet (AF).


### **1. Abatement Costs**

For each irrigation district, plot the marginal abatement cost data (from the data provided) and estimate a linear regression model with zero intercept. These estimated linear regressions will be your estimates of the marginal abatement cost curve (one for each irrigation district), which you will use for the remainder of this analysis.

#### **MC Across Counties**
```{r}
districts_sub <- districts %>% 
  rename(kern = mc_kern,
         mojave = mc_mojave,
         antelope = mc_antelope,
         ventura = mc_ventura) %>% 
  pivot_longer(cols = c(kern, mojave, antelope, ventura),
               names_to = 'county',
               values_to = 'mc')

ggplot(data = districts_sub, aes(x = reduction, y = mc)) + 
  geom_point(aes(color = county)) +
  scale_color_manual("County", 
                     values = c('cadetblue3', 'darkgoldenrod1',
                     'darkolivegreen4', 'sienna2')) +
  labs(x = "Reduction (AF)", y = "Marginal Cost ($/AF)")

# Linear model for Kern MC forcing 0 intercept 

lm_kern <- lm(mc_kern ~ 0 + reduction, data = districts)
extract_eq(model = lm_kern, use_coefs = TRUE)

# Linear model for Mojave MC forcing 0 intercept 

lm_mojave <- lm(mc_mojave ~ 0 + reduction, data = districts)
extract_eq(model = lm_mojave, use_coefs = TRUE)

# Linear model for Antelope MC forcing 0 intercept 

lm_antelope <- lm(mc_antelope ~ 0 + reduction, data = districts)
extract_eq(model = lm_antelope, use_coefs = TRUE)

# Linear model for Ventura MC forcing 0 intercept 

lm_ventura <- lm(mc_ventura ~ 0 + reduction, data = districts)
extract_eq(model = lm_ventura, use_coefs = TRUE)

```


### **2. Demand Assessment**

```{r}
# Make a predict data set from the linear models 

kern_predict <- predict(lm_kern)
mojave_predict <- predict(lm_mojave)
antelope_predict <- predict(lm_antelope)
ventura_predict <- predict(lm_ventura)

districts_predict <- data.frame(districts, kern_predict, mojave_predict, antelope_predict, ventura_predict)

# Now clean this like before 

districts_predict_clean <- districts_predict %>% 
  select(-mc_kern, -mc_mojave, -mc_antelope, -mc_ventura) %>% 
  rename(kern = kern_predict,
         mojave = mojave_predict,
         antelope = antelope_predict,
         ventura = ventura_predict) %>% 
  pivot_longer(cols = c(kern, mojave, antelope, ventura),
               names_to = 'county',
               values_to = 'mc')

# This will be the new MC data set 
  
```

Using your estimated marginal abatement cost curves, derive each district’s demand curve for water. In other words, how much would each district be willing to pay for the right to use the first AF of water, second AF, etc.? Plot each district’s demand curve on a single graph. Which sector is willing to pay the most for the first AF of water?

## **Figure X**

```{r}
# Caluclate demand curves:
# Kern (Baseline = 150) --> 2.29(A) 
## 2.29(150 - A) --> 343.5 - 2.29A

# Mojave (Baseline = 140) --> 3.8(A)
## 3.8(140 - A) --> 532 - 3.8A

# Antelope (Baseline = 220) --> 2.86(A)
## 2.86(220 - A) --> 629.2 - 2.86A

# Ventura (Baseline = 245) --> 1.78(A)
## 1.78(245 - A) --> 436.1 - 1.78A



ggplot(data = districts_predict_clean, aes(x = reduction, y = mc)) +
  geom_line(aes(color = county)) +
  scale_color_manual("County", 
                     values = c('cadetblue3', 'darkgoldenrod1',
                     'darkolivegreen4', 'sienna2')) +
  geom_abline(color = "darkgoldenrod1",
              intercept = 343.5, slope= -lm_kern$coefficients) +
  geom_abline(color = "darkolivegreen4",
              intercept = 532, slope= -lm_mojave$coefficients) +
  geom_abline(color = "cadetblue3",
              intercept = 629.2, slope= -lm_antelope$coefficients) +
  geom_abline(color = "sienna2",
              intercept = 436.1, slope= -lm_ventura$coefficients) +
  labs(x = "Reduction (AF)", y = "Marginal Cost ($/AF)")

```

Based on the graph above, Antelope County is willing to pay the most for the first unit of water. 

### **3. Policy Considerations**

Here you will analyze three alternative policies for reducing water use among these irrigation districts. In total, these irrigation districts will need to reduce water consumption from the current 755 AF down to 500 AF. For each intervention listed below, perform the following calculations: (1) calculate the stringency of the policy (defined below for each intervention) required to achieve the 500 AF target, (2) 
calculate the total cost of meeting the target using that approach, (3) calculate the cost to each district, and (4) calculate the tax revenue generated.
a. Cap without trade. Reduce each district’s water use by the same fraction (e.g., 1/3 of current baseline use), so the 500 AF target is met. Trade is not allowed. Stringency is defined as the magnitude of the fraction.
b. Tax on water use. A single tax is implemented on all water use in each of the four districts, such that water use is reduced to the 500 AF target. Stringency is defined as the magnitude of the tax.
c. Cap and trade. Cap water use as in part (a), but after those caps are set, allow trade across districts. How much water is used by each district after trade? Stringency is the same as in part (a).


### **4. Drought Sensitivity**

A severe drought hits California, and it is necessary to reduce water use from 500 AF down to 300 AF. Your job is to estimate the cost of the drought (i.e., the cost of reducing water use from 500 AF to 300 AF) to each irrigation district under each policy. Considering the entire jump from status quo (755 AF) to the drought (300 AF), which policy is preferred by each irrigation district? How does your answer depend on 
how rights are allocated to each district (in policies (a) and (c))
